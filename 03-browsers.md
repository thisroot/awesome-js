По мотивам: https://www.html5rocks.com/ru/tutorials/internals/howbrowserswork/

## Общее
- Браузеры предназначены в большей части для того чтобы отбражать HTML документы, стандарт для которых разрабатывается консорциумом W3C
- Не существует стандарта отражающего требования к интерфейсу браузера

## Структура верхнего уровня Браузера
- Пользовательский интерфейс, кроме окна
- Движок браузера - мост меджу интерфейсом браузера и модулем отображения
- Модуль отображения
- Сетевые компоенты
- Исполнительная часть пользовательского интерфейса - используется для отображения нативных операционной системе виджетов
- Движок JavaScript
- Хранилища данных

## Схема работы
- Модуль отображения получает содержимое документа фрагментами
- Выполняет синтаксический анализ HTML документа и переводит теги в узлы DOM `дерева содержания`
- Информация о стилях извлекается мз CSS документов и элементов style. Эта информация и инстукции по отображению используются для создания `дерева отображения`
- Происходит компоновка элементов, в ходе которой каждому узлу присваиваются координаты точек на экране
- Отрисовка

![](https://www.html5rocks.com/ru/tutorials/internals/howbrowserswork/webkitflow.png)

## Синтаксический анализатор
- Лексический анализ - разбор входящих последовательностей на токены
- Синтакисческий анализатор - анализирующий структуру документа, согласно синтаксическим правилам языка и формирующим синтаксическое дерево
- Анализ является итеративным процессом: Синтаксический анализатор запрашивает новый токен у лексического анализатора, и если тот валиден формирует из него узел DOM. Если токен не соответствует ни однму из правил, синтаксичесий анализатор откладывает его и запашивает новы токен. Так продолжается до момента когдв весь документ не будет разоьран 


## Дерево отображения

![](https://www.html5rocks.com/ru/tutorials/internals/howbrowserswork/image025.png)

- Включает в себя все элементы подлежащие выводу на экран
  - Включая теневой DOM
  - Исключая скрытые стилями обьекты
  - Локализируя плавающие элементы и элементы с абсолютным позиционированием в отдельной части дерева

## компоновка
- Выполняет расчет значений размеров и положений элементов дерева отображения
- Чтобы не выполнят перекомпоновку при каждом изменении, браузеры используют систему "грязных битов". Измененный объект отображения и его дочерние элементы помечаются как грязные - требующие перекомпоновки
- Может быть глобальной и инкрементной
- При инкриметной компоновке пересчету подвергаются обьекты помеченные как грязные
- Инкрементная компоновка асинхронна. Все задачи инкрементной компоновки помещаются в очередь и выполняются после глобальной

![](https://www.html5rocks.com/ru/tutorials/internals/howbrowserswork/reflow.png)

## отрисовка
- Вычисляются: цвет фона, фоновое изображение, рамка, дочернике элементы, внешние границы
- Перед повторной отрисовкой старое отображение элемента сохраняется как растровое, а затем отрисовываются только различия меджу старым и новыми прямоугольником

## Поток модуля отображения
- Является однопоточным - основной поток браузера или процесс вкладки
- Цикл событий - основной поток браузера - бесконечный цикл ожидающий событий layout и paint
